<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CleanMate - í•„ìˆ˜ í™•ì¸</title>
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", system-ui, sans-serif; background:#f5f7fb; color:#222; margin:0; }
    .wrap{ max-width:900px; margin:0 auto; padding:18px; }
    .card{ background:#fff; border-radius:16px; padding:16px; box-shadow:0 10px 26px rgba(15,35,52,.08); border:1px solid rgba(0,0,0,.04); margin-bottom:12px; }
    h1{ font-size:18px; margin:0 0 10px; }
    h2{ font-size:15px; margin:0 0 10px; }
    .muted{ color:#6b7280; font-size:12px; line-height:1.5; }
    .box{ background:#f9fafc; border:1px solid #e5e7eb; padding:12px; border-radius:12px; font-size:13px; line-height:1.6; }
    .danger{ background:#fff8e1; border:1px solid #ffe082; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; background:#e3f2fd; color:#1565c0; font-size:12px; font-weight:600; }
    .check{ display:flex; gap:8px; align-items:flex-start; margin-top:10px; font-size:13px; }
    .check input{ margin-top:3px; }
    .btn{
      width:100%; padding:12px 14px; border-radius:999px; border:none;
      background:#0288d1; color:#fff; font-weight:800; font-size:14px; cursor:pointer;
      box-shadow:0 12px 20px rgba(2,136,209,.25);
    }
    .btn:disabled{ opacity:.4; cursor:not-allowed; box-shadow:none; }
    .topbar{ display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:12px; }
    .back{ border:1px solid #d1d9e6; background:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; }
    .summary{ font-size:13px; line-height:1.6; }
    .summary b{ color:#0288d1; }
  </style>
</head>
<body>
  <div class="wrap">
<div style="text-align:center;margin-bottom:12px;">
  <img src="logo-cleanmate.png" alt="CleanMate ë¡œê³ " style="height:42px;opacity:0.9;">
</div>
    <div class="topbar">
      <button class="back" onclick="history.back()">â† ë’¤ë¡œ</button>
      <span class="pill">í•„ìˆ˜ í™•ì¸ í˜ì´ì§€</span>
    </div>

    <div class="card">
<h1>í•„ìˆ˜ ì•ˆë‚´ í˜ì´ì§€ì…ë‹ˆë‹¤.</h1>
<div class="muted">
  ì˜ˆì•½ ì§„í–‰ ì „, ì•„ë˜ ë‚´ìš©ì„ ë°˜ë“œì‹œ í™•ì¸í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
</div>
    </div>

    <div class="card">
      <h2>ğŸ“Œ ê³ ê°ë‹˜ì˜ ê²¬ì  ìš”ì•½</h2>
<div class="muted">
  ê³ ê°ë‹˜ê»˜ì„œ ì„ íƒí•˜ì‹  êµ¬ì¡°Â·ì˜µì…˜Â·ì¼ì •ì„ ê¸°ì¤€ìœ¼ë¡œ ì‚°ì¶œëœ ì˜ˆìƒ ê²¬ì ì…ë‹ˆë‹¤.
</div>
      <div id="summary" class="box summary">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>
      <div class="muted" style="margin-top:8px;">
    
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’¥ ì²­ì†Œ ë²”ìœ„ ì•ˆë‚´ (ë§¤ìš° ì¤‘ìš”)</h2>
      <div class="box">
        ëª¨ë“  ì²­ì†ŒëŠ” <b>ì§‘ ë‚´ë¶€</b> ê¸°ì¤€ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.<br/>
        âœ… í¬í•¨: <b>í˜„ê´€ë¬¸ ì•ˆìª½</b>, <b>ë‚´ë¶€ ìƒ·ì‹œ</b>, <b>ë°©ì¶©ë§ ì•ˆìª½</b><br/>
        âŒ ì œì™¸: <b>ì™¸ë¶€ ì°½ë¬¸</b>, <b>ì™¸ë¶€ ìƒ·ì‹œ</b>, <b>ê±´ë¬¼ ê³µìš©ë¶€</b>
      </div>
    </div>

    <div class="card">
      <h2>âœ… í˜„ì¥ ì¶”ê°€ ë¹„ìš© ë°œìƒ ê°€ëŠ¥ í•­ëª©</h2>
      <div class="box">
        ì•„ë˜ í•­ëª©ì€ í˜„ì¥ í™•ì¸ í›„ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
        1) ë¹„í™•ì¥ ë² ë€ë‹¤<br/>
        2) ì‹¬í•œ ì˜¤ì—¼ë„ / ê³°íŒ¡ì´ / ë‹ˆì½”í‹´<br/>
        3) ìŠ¤í‹°ì»¤ ì œê±°(ë¾±ë¾±ì´ ë“±)<br/>
        4) ì—˜ë¦¬ë² ì´í„° ì—†ëŠ” 3ì¸µ ì´ìƒ<br/>
        5) ë°˜ë ¤ê²¬/ë°˜ë ¤ë¬˜ í˜„ì¥(í„¸Â·ì•…ì·¨)<br/>
        6) ì™¸ë¶€ ì°½ë¬¸ ì²­ì†Œ<br/>
        7) ë¶„ì§„ ì˜¤ì—¼ë„ê°€ ì‹¬í•œ ê²½ìš°<br/>
        8) ì•¼ì™¸ í…Œë¼ìŠ¤(í˜„ì¥ ì¡°ìœ¨)<br/>
        9) ê²¬ì ê³¼ ìƒì´í•œ í‰ìˆ˜Â·êµ¬ì¡°(ë°© ê°œìˆ˜/ì „ì‹¤/ë³µì¸µ ë“±)<br/>
        10) ì£¼ì°¨ê³µê°„ ë¯¸í™•ë³´ ì‹œ ì£¼ì°¨ ë¹„ìš©(ê³ ê° ë¶€ë‹´)
      </div>
      <div class="muted" style="margin-top:8px;">
        ì¶”ê°€ ë¹„ìš©ì€ <b>í˜„ì¥ ì„¤ëª… í›„ ê³ ê° ë™ì˜</b> ì—†ì´ ì„ì˜ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </div>
    </div>

    <div class="card">
      <h2>ğŸ“· ì˜¤ì—¼ë„ ì‚¬ì§„ ë¯¸ì²¨ë¶€ ì‹œ ê³ ì§€</h2>
      <div class="box">
        ì˜¤ì—¼ë„ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì§€ ì•Šì€ ê²½ìš°,<br/>
        í˜„ì¥ í™•ì¸ ê²°ê³¼ì— ë”°ë¼ ì¶”ê°€ ë¹„ìš©ì´ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br/>
        ë‹¨, <b>ì¶”ê°€ ë¹„ìš© ì•ˆë‚´ í›„ ê³ ê° ë™ì˜ ì—†ì´ ì„ì˜ ì§„í–‰í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</b>
      </div>
    </div>

    <div class="card">
      <h2>ğŸ’¥ ì˜ˆì•½ ì·¨ì†Œ/ë³€ê²½/ìœ„ì•½ê¸ˆ ê·œì •</h2>
      <div class="box danger">
        (ì²­ì†Œ ì˜ˆì•½ ë‚ ì§œ ê¸°ì¤€)<br/>
        - <b>3ì¼ ì „ê¹Œì§€</b>: ë¬´ë£Œ ì·¨ì†Œ(ì˜ˆì•½ê¸ˆ í™˜ë¶ˆ), ë‚ ì§œ/ì‹œê°„ ë³€ê²½ ê°€ëŠ¥<br/>
        - <b>2ì¼ ì „ ~ ë‹¹ì¼</b>: ì˜ˆì•½ê¸ˆ ì†Œë©¸<br/>
        - <b>í˜„ì¥ í‡´ê±°</b>: ì˜ˆì•½ê¸ˆ ì†Œë©¸ + ì²­ì†Œê¸ˆì•¡ì˜ <b>50% ìœ„ì•½ê¸ˆ</b>
      </div>
    </div>

    <div class="card">
      <h2>âœ… ë™ì˜ ì²´í¬ (í•„ìˆ˜)</h2>

      <label class="check">
        <input type="checkbox" id="agreeScope" />
        <span>ì²­ì†Œ ë²”ìœ„(ë‚´ë¶€ ê¸°ì¤€, ì™¸ë¶€ ì œì™¸)ë¥¼ í™•ì¸í–ˆê³  ë™ì˜í•©ë‹ˆë‹¤.</span>
      </label>

      <label class="check">
        <input type="checkbox" id="agreeExtra" />
        <span>í˜„ì¥ ì¶”ê°€ ë¹„ìš© ë°œìƒ ê°€ëŠ¥ í•­ëª©ì„ í™•ì¸í–ˆê³  ë™ì˜í•©ë‹ˆë‹¤.</span>
      </label>

      <label class="check">
        <input type="checkbox" id="agreeCancel" />
        <span>ì·¨ì†Œ/ë³€ê²½/ìœ„ì•½ê¸ˆ ê·œì •ì„ í™•ì¸í–ˆê³  ë™ì˜í•©ë‹ˆë‹¤.</span>
      </label>

      <label class="check">
        <input type="checkbox" id="agreeAll" />
        <span><b>ìœ„ ë‚´ìš©ì„ ëª¨ë‘ í™•ì¸í•˜ì˜€ìœ¼ë©° ë™ì˜í•©ë‹ˆë‹¤.</b></span>
      </label>

      <button id="finalBtn" class="btn" disabled onclick="finalSubmit()">
        ë™ì˜ í›„ ì˜ˆì•½ ìš”ì²­ì„ ì§„í–‰í•©ë‹ˆë‹¤.
      </button>

      <div class="muted" style="margin-top:10px;">
        * ë™ì˜ ì²´í¬ ê¸°ë¡ì€ ì˜ˆì•½/ë¶„ìŸ ëŒ€ì‘ì„ ìœ„í•´ ì €ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const SUPABASE_URL = "https://nuchpyxjyqcpldpnffhu.supabase.co";
const SUPABASE_KEY = "sb_publishable_edX6Oi2eo5A5MjYYo323Fg_6ESnzQmL";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// payload ë¶ˆëŸ¬ì˜¤ê¸°
const payload = JSON.parse(localStorage.getItem("cleanmate_payload") || "null");
const priceText = payload.total_price_text;   // "330,000ì›"
const priceNumber = priceText
  ? parseInt(priceText.replace(/[^\d]/g, ""), 10)
  : null;
  
// ìš”ì•½ í‘œì‹œ
const summaryEl = document.getElementById("summary");
if (!payload) {
  summaryEl.innerHTML = "ì´ì „ í˜ì´ì§€ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„í–‰í•´ì£¼ì„¸ìš”.";
} else {
  summaryEl.innerHTML = `
    ê³ ê°: <b>${payload.name || "-"}</b> (${payload.phone || "-"})<br/>
    ì£¼ì†Œ: ${payload.address || "-"}<br/>
    ì²­ì†Œì¼: <b>${payload.clean_date || "-"}</b> / ì‹œê°„: <b>${payload.clean_time || "-"}</b>
    ${payload.side_clean_time ? `<br/>ì‚¬ì´ì²­ì†Œ ì‹œê°„: <b>${payload.side_clean_time}</b>` : ""}
    <br/>
    êµ¬ì¡°/í‰ìˆ˜: ${payload.structure || "-"} / ${payload.supply_area ?? "-"}í‰<br/>
    ì˜ˆìƒ ê²¬ì : <b>${payload.total_price_text || "-"}</b><br/>
    ë©”ëª¨: ${payload.memo || "-"}
  `;
}

// ë™ì˜ ì²´í¬ ë¡œì§
const agreeScope = document.getElementById("agreeScope");
const agreeExtra = document.getElementById("agreeExtra");
const agreeCancel = document.getElementById("agreeCancel");
const agreeAll = document.getElementById("agreeAll");
const finalBtn = document.getElementById("finalBtn");

function syncAgreeAll() {
  const baseAll = agreeScope.checked && agreeExtra.checked && agreeCancel.checked;
  agreeAll.checked = baseAll;
  finalBtn.disabled = !(baseAll && agreeAll.checked && payload);
}

agreeScope.onchange = syncAgreeAll;
agreeExtra.onchange = syncAgreeAll;
agreeCancel.onchange = syncAgreeAll;
agreeAll.onchange = syncAgreeAll;

// ìµœì¢… ì œì¶œ
async function finalSubmit() {
  if (!payload) {
    alert("ì´ì „ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
    return;
  }

  const { error: customerError } = await supabaseClient
    .from("customers")
    .upsert(
      {
        name: payload.name,
        phone: payload.phone,
        address: payload.address,
        memo: payload.memo
      },
      { onConflict: "phone" }
    );

  if (customerError) {
    alert("ê³ ê° ì €ì¥ ì˜¤ë¥˜");
    return;
  }

  const { error: orderError } = await supabaseClient
    .from("orders")
.insert([{
  name: payload.name,
  phone: payload.phone,
  address: payload.address,
  memo: payload.memo,
  structure: payload.structure,
  supply_area: payload.supply_area,
  estimated_price_text: payload.total_price_text,
  estimated_price_number: priceNumber,
  clean_date: payload.clean_date,
  clean_time: payload.clean_time,
  side_clean_time: payload.side_clean_time,
  status: "ì ‘ìˆ˜ë¨"
}]);

  if (orderError) {
    alert("ì˜ˆì•½ ì €ì¥ ì˜¤ë¥˜");
    return;
  }

   localStorage.removeItem("cleanmate_payload");

  alert(
    "ì˜ˆì•½ ìš”ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.\n\n" +
    "ì…ê¸ˆ í™•ì¸ í›„ ìš°ìˆ˜ ì—…ì²´ê°€ ìë™ìœ¼ë¡œ ë°°ì •ë©ë‹ˆë‹¤."
  );

  window.location.href = "deposit.html";
}
</script>

</body>

</html>
