<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì—…ì²´ í˜ì´ì§€ | CleanMate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body{
      margin:0;
      padding:20px;
      font-family:-apple-system, BlinkMacSystemFont, "Noto Sans KR", system-ui;
      background:#f5f7fb;
    }

    header{
      max-width:1200px;
      margin:0 auto 20px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    header h1{
      margin:0;
      font-size:20px;
      color:#2e7d32;
    }

    .container{
      max-width:1200px;
      margin:0 auto;
    }

    .card{
      background:#fff;
      border-radius:14px;
      padding:16px;
      margin-bottom:12px;
      box-shadow:0 6px 18px rgba(0,0,0,0.06);
      font-size:14px;
    }

    .status{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
    }

    .status.assigned{ background:#e3f2fd; color:#1565c0; }
    .status.done{ background:#e8f5e9; color:#2e7d32; }

    button{
      padding:6px 12px;
      border-radius:8px;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      font-weight:600;
    }
  </style>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<header>
  <h1>ğŸ¢ ì—…ì²´ ì „ìš© í˜ì´ì§€</h1>
  <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
</header>

<div class="container" id="orderList">
  ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
</div>

<script>
/* ===============================
   1ï¸âƒ£ Supabase ì—°ê²°
   =============================== */
const SUPABASE_URL = "https://nuchpyxjyqcpldpnffhu.supabase.co";
const SUPABASE_KEY = "sb_publishable_edX6Oi2eo5A5MjYYo323Fg_6ESnzQmL";

const supabaseClient = supabase.createClient(
  SUPABASE_URL,
  SUPABASE_KEY
);

/* âš ï¸ ì§€ê¸ˆì€ ì—…ì²´ ê³ ì • */
const COMPANY_NAME = "í™˜ìŠ¹í´ë¦°";

/* ===============================
   2ï¸âƒ£ ì—…ì²´ì— ë°°ì •ëœ ì£¼ë¬¸ë§Œ ì¡°íšŒ
   =============================== */
async function loadOrders(){
  const list = document.getElementById("orderList");
  list.innerHTML = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

  const { data, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("assigned_company", COMPANY_NAME)
    .order("created_at", { ascending:false });

  if(error){
    list.innerHTML = "ì£¼ë¬¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";
    console.error(error);
    return;
  }

  if(!data || data.length === 0){
    list.innerHTML = "ë°°ì •ëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.";
    return;
  }

  list.innerHTML = data.map(order => `
    <div class="card">
      <b>${order.name}</b> (${order.phone})<br>
      ì£¼ì†Œ: ${order.address || "-"}<br>
      ì²­ì†Œì¼: ${order.clean_date || "-"}<br>
      ìƒíƒœ:
      <span class="status ${
        order.status === "ì™„ë£Œ" ? "done" : "assigned"
      }">
        ${order.status}
      </span>
    </div>
  `).join("");
}

/* ===============================
   ê¸°íƒ€
   =============================== */
function logout(){
  location.href = "index.html";
}

/* ìµœì´ˆ ì‹¤í–‰ */
loadOrders();
</script>

</body>
</html>
