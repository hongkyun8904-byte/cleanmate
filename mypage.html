<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CleanMate - ì˜ˆì•½ í™•ì¸</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

  <style>
    body{
      margin:0;
      background:#f5f7fb;
      font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif;
      color:#222;
    }
    .wrap{
      max-width:520px;
      margin:0 auto;
      padding:18px;
    }
    .logo{
      text-align:center;
      margin-bottom:14px;
    }
    .logo img{ height:42px; }

    .card{
      background:#fff;
      border-radius:16px;
      padding:16px;
      box-shadow:0 10px 26px rgba(15,35,52,.08);
      margin-bottom:12px;
    }
    h1{ font-size:18px;margin:0 0 8px; }
    h2{ font-size:15px;margin:0 0 6px; }

    input{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid #d1d9e6;
      font-size:14px;
    }
    button{
      width:100%;
      margin-top:10px;
      padding:12px;
      border:none;
      border-radius:999px;
      background:#0288d1;
      color:#fff;
      font-weight:800;
      cursor:pointer;
    }

    .status{
      padding:10px;
      border-radius:12px;
      font-size:13px;
      margin-top:8px;
    }
    .wait{ background:#fff8e1; border:1px solid #ffe082; }
    .done{ background:#e3f2fd; border:1px solid #90caf9; }

    .label{ color:#6b7280;font-size:12px; }
  </style>
</head>
<body>

<div class="wrap">

<!-- âœ… ìƒë‹¨ ë¡œê³  (í¬ê²Œ + ë©”ì¸ ì´ë™) -->
<div style="text-align:center;margin:16px 0 10px;">
  <a href="index.html">
    <img 
      src="logo-cleanmate.png"
      alt="CleanMate ë¡œê³ "
      style="height:72px;opacity:0.95;"
    >
  </a>
</div>
<div style="
  display:flex;
  justify-content:space-between;
  margin-bottom:16px;
">
<button onclick="history.back()" style="
  padding:8px 12px;
  border-radius:10px;
  border:1.5px solid #0288d1;
  background:#fff;
  color:#0288d1;
  font-size:14px;
  font-weight:700;
  cursor:pointer;
">
  â† ì´ì „ìœ¼ë¡œ
</button>

  <button onclick="goHome()" style="
    padding:8px 14px;
    border-radius:10px;
    border:none;
    background:#0288d1;
    color:#fff;
    cursor:pointer;
  ">
    í™ˆìœ¼ë¡œ
  </button>
</div>
  <div class="card">
    <h1>ì˜ˆì•½ ìƒíƒœ í™•ì¸</h1>
    <div class="label">ì˜ˆì•½ ì‹œ ì…ë ¥í•˜ì‹  íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</div>

    <input id="phoneInput" placeholder="010-0000-0000" />
    <button onclick="loadMyOrder()">ì˜ˆì•½ ì¡°íšŒí•˜ê¸°</button>
  </div>

  <div id="result"></div>

</div>

<script>
const SUPABASE_URL = "https://nuchpyxjyqcpldpnffhu.supabase.co";
const SUPABASE_KEY = "sb_publishable_edX6Oi2eo5A5MjYYo323Fg_6ESnzQmL";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  function goHome(){
  window.location.href = "index.html";
}
  
async function loadMyOrder(){
  const phone = document.getElementById("phoneInput").value.trim();
  const box = document.getElementById("result");

  if(!phone){
    alert("íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  box.innerHTML = "ì¡°íšŒ ì¤‘ì…ë‹ˆë‹¤...";

  const { data, error } = await supabaseClient
    .from("orders")
    .select("*")
    .eq("phone", phone)
    .order("created_at", { ascending:false })
    .limit(1);

  if(error || !data || data.length === 0){
    box.innerHTML = `
      <div class="card">
        ì˜ˆì•½ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
      </div>
    `;
    return;
  }

  const o = data[0];
  // âœ… ì˜ˆì•½ê¸ˆ / ì”ê¸ˆ ê³„ì‚°
const depositAmount = 60000; // ì˜ˆì•½ê¸ˆ 6ë§Œì›
const totalAmount = o.estimated_price_number || 0;
const remainingAmount = totalAmount
  ? totalAmount - depositAmount
  : null;

  let statusBox = "";
  if(o.status === "ë°°ì •ì™„ë£Œ"){
    statusBox = `<div class="status done">âœ… ìš°ìˆ˜ ì—…ì²´ê°€ ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.</div>`;
  }else{
    statusBox = `<div class="status wait">â³ í˜„ì¬ ì˜ˆì•½ ì ‘ìˆ˜ ìƒíƒœì…ë‹ˆë‹¤.</div>`;
  }

  box.innerHTML = `
    <div class="card">
      <h2>ê³ ê°ë‹˜ì˜ ì˜ˆì•½ ì •ë³´</h2>

      ${statusBox}

      <p><b>ì²­ì†Œ ì¼ì •</b><br>
      ${o.clean_date || "-"} / ${o.clean_time || "-"}</p>
      <p><b>ê²°ì œ ì •ë³´</b><br>
ì˜ˆì•½ê¸ˆ: <b>60,000ì›</b><br>
ì”ê¸ˆ: <b>
  ${remainingAmount !== null
    ? remainingAmount.toLocaleString("ko-KR") + "ì›"
    : "-"}
</b>
</p>

      ${o.side_clean_time ? `<p><b>ì‚¬ì´ì²­ì†Œ</b><br>${o.side_clean_time}</p>` : ""}

      <p><b>ì£¼ì†Œ</b><br>${o.address || "-"}</p>

      <p><b>ë°°ì • ì—…ì²´</b><br>
      ${o.assigned_company || "ë°°ì • ëŒ€ê¸° ì¤‘"}</p>

      <p class="label">
        * ì…ê¸ˆ í™•ì¸ í›„ ìš°ìˆ˜ ì—…ì²´ê°€ ìë™ ë°°ì •ë©ë‹ˆë‹¤.
      </p>
      <button onclick="openKakao()" style="
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:999px;
  background:#111;
  color:#fff;
  font-size:14px;
  font-weight:800;
  cursor:pointer;
">
  ğŸ’¬ í´ë¦°ë©”ì´íŠ¸ ìƒë‹´ì›ê³¼ ìƒë‹´í•˜ê¸°
</button>
    </div>
  `;
}
  function openKakao() {
  window.open("https://open.kakao.com/o/sItc0P4h", "_blank");
}
</script>

</body>

</html>


